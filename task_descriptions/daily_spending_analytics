â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ TASK DESCRIPTION - ANALIZA COMPORTAMENTULUI DE CHELTUIELI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Trebuie sÄƒ creezi un raport complet de analizÄƒ a cheltuielilor clienÈ›ilor
pentru a Ã®nÈ›elege pattern-urile de consum È™i a segmenta clienÈ›ii.

ğŸ“Š CE TREBUIE SÄ‚ CALCULEZI (Ã®n ordine):

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 1: CTE "transaction_details" 
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Pentru fiecare tranzacÈ›ie extrage:
- transaction_id, client_id, amount, merchant, category
- transaction_hour: ora din zi (0-23) folosind HOUR(transaction_date)
- transaction_day_of_week: ziua sÄƒptÄƒmÃ¢nii (1=DuminicÄƒ, 7=SÃ¢mbÄƒtÄƒ) 
  folosind DAYOFWEEK(transaction_date)
- time_of_day: clasificÄƒ ora Ã®n:
    * 'Morning' (6-11)
    * 'Afternoon' (12-17)
    * 'Evening' (18-22)
    * 'Night' (23-5)
- is_weekend: TRUE dacÄƒ transaction_day_of_week este 1 sau 7, altfel FALSE

FiltreazÄƒ doar tranzacÈ›iile din event_date unde client_id È™i amount nu sunt NULL.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 2: CTE "client_spending_summary"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GrupeazÄƒ dupÄƒ client_id È™i calculeazÄƒ:
- total_spent: suma totalÄƒ cheltuitÄƒ
- transaction_count: numÄƒrul de tranzacÈ›ii
- avg_transaction: media valorii tranzacÈ›iilor (rotunjitÄƒ la 2 zecimale)
- max_transaction: cea mai mare tranzacÈ›ie
- min_transaction: cea mai micÄƒ tranzacÈ›ie
- unique_merchants: numÄƒr de comercianÈ›i unici (COUNT(DISTINCT merchant))
- unique_categories: numÄƒr de categorii unice
- weekend_spending: suma cheltuitÄƒ Ã®n weekend (SUM(CASE WHEN is_weekend...))
- weekday_spending: suma cheltuitÄƒ Ã®n timpul sÄƒptÄƒmÃ¢nii
- morning_transactions: numÄƒr tranzacÈ›ii dimineaÈ›a
- evening_transactions: numÄƒr tranzacÈ›ii seara

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 3: CTE "category_breakdown"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GrupeazÄƒ dupÄƒ client_id È™i calculeazÄƒ pentru fiecare categorie:
- groceries_spent: suma pentru categoria 'groceries'
- food_spent: suma pentru 'food'
- entertainment_spent: suma pentru 'entertainment'
- shopping_spent: suma pentru 'shopping'
- transport_spent: suma pentru 'transport'
- bills_spent: suma pentru 'bills'
- other_spent: suma pentru orice altÄƒ categorie

Hint: FoloseÈ™te SUM(CASE WHEN category = 'groceries' THEN amount ELSE 0 END)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 4: CTE "merchant_preferences"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Pentru fiecare client, identificÄƒ comerciantul favorit:
- client_id
- favorite_merchant: comerciantul la care a cheltuit cel mai mult
- favorite_merchant_spending: suma cheltuitÄƒ la acel comerciant
- favorite_merchant_visits: numÄƒrul de vizite la acel comerciant

Hint: GrupeazÄƒ dupÄƒ client_id È™i merchant, calculeazÄƒ suma È™i numÄƒrul,
apoi foloseÈ™te ROW_NUMBER() OVER (PARTITION BY client_id ORDER BY suma DESC)
pentru a selecta doar primul comerciant (WHERE row_num = 1).

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 5: CTE "spending_patterns"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CalculeazÄƒ statistici globale pentru comparaÈ›ie:
- avg_spending_all_clients: media cheltuielilor tuturor clienÈ›ilor
- stddev_spending: deviaÈ›ia standard a cheltuielilor
- percentile_25: percentila 25 (foloseÈ™te PERCENTILE_CONT(0.25) 
  WITHIN GROUP (ORDER BY total_spent))
- percentile_75: percentila 75

Acestea vor fi valori scalare, deci foloseÈ™te CROSS JOIN pentru a le 
ataÈ™a fiecÄƒrui client.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 6: CTE "client_accounts"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Din tabelul accounts_clean:
- client_id
- total_opening_balance: suma opening_balance pentru toate conturile clientului
- account_count: numÄƒrul de conturi
- primary_account_type: tipul de cont cu cea mai mare opening_balance
  (foloseÈ™te ROW_NUMBER() similar cu STEP 4)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 7: CTE "final_analytics"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CombinÄƒ toate CTE-urile anterioare cu LEFT JOIN È™i calculeazÄƒ:

A. METRICI DE BAZÄ‚ (din CTE-uri anterioare):
   - Toate coloanele din client_spending_summary
   - Toate coloanele din category_breakdown
   - favorite_merchant, favorite_merchant_spending (din merchant_preferences)
   - total_opening_balance, account_count, primary_account_type (din client_accounts)

B. METRICI CALCULATE:
   - spending_frequency: transaction_count / 24.0 (tranzacÈ›ii pe orÄƒ Ã®n medie)
   - weekend_ratio: weekend_spending / NULLIF(total_spent, 0) * 100 
     (procent weekend, rotunjit la 1 zecimalÄƒ)
   - diversity_score: (unique_merchants + unique_categories) / 2.0
     (cÃ¢t de divers cheltuieÈ™te)
   - spending_to_balance_ratio: total_spent / NULLIF(total_opening_balance, 0)
     (cÃ¢t din balantÄƒ cheltuieÈ™te, rotunjit la 3 zecimale)

C. CLASIFICÄ‚RI:
   - spending_tier: bazat pe comparaÈ›ie cu avg_spending_all_clients
       * 'High Spender' dacÄƒ > avg + stddev
       * 'Above Average' dacÄƒ > avg
       * 'Average' dacÄƒ Ã®ntre percentile_25 È™i percentile_75
       * 'Low Spender' altfel
   
   - customer_segment: clasificare complexÄƒ bazatÄƒ pe comportament
       * 'VIP - High Value' dacÄƒ total_spent > 2000 AND diversity_score > 5
       * 'Weekend Warrior' dacÄƒ weekend_ratio > 60
       * 'Routine Shopper' dacÄƒ unique_merchants <= 3 AND transaction_count > 8
       * 'Bargain Hunter' dacÄƒ avg_transaction < 50
       * 'Impulsive Buyer' dacÄƒ max_transaction > avg_transaction * 5
       * 'Regular Customer' altfel
   
   - shopping_preference: categoria Ã®n care cheltuieÈ™te cel mai mult
       FoloseÈ™te GREATEST() pentru a gÄƒsi maximul Ã®ntre toate categoriile
       È™i apoi CASE pentru a identifica care este aceea
   
   - risk_indicator: indicator de risc financiar
       * 'High Risk' dacÄƒ spending_to_balance_ratio > 0.8
       * 'Medium Risk' dacÄƒ > 0.5
       * 'Low Risk' altfel
       * 'Unknown' dacÄƒ total_opening_balance este NULL sau 0
   
   - time_preference: cÃ¢nd preferÄƒ sÄƒ facÄƒ tranzacÈ›ii
       * 'Morning Person' dacÄƒ morning_transactions > evening_transactions
       * 'Evening Person' altfel

D. RECOMANDÄ‚RI:
   - marketing_action: recomandare de acÈ›iune bazatÄƒ pe segment
       * Pentru 'VIP - High Value': 'Offer Premium Services'
       * Pentru 'Bargain Hunter': 'Send Discount Offers'
       * Pentru 'Weekend Warrior': 'Weekend Promotions'
       * Pentru 'High Risk': 'Financial Advisory Needed'
       * Pentru alÈ›ii: 'Standard Marketing'

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STEP 8: SELECT final
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SelecteazÄƒ toate coloanele din final_analytics È™i adaugÄƒ:
- report_date: '{event_date}' ca primul cÃ¢mp

OrdoneazÄƒ dupÄƒ:
1. total_spent DESC (cei care cheltuiesc mai mult primii)
2. diversity_score DESC (apoi dupÄƒ diversitate)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ HINTS & TIPS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- FoloseÈ™te COALESCE() pentru a evita NULL-uri Ã®n calcule
- NULLIF(value, 0) previne Ã®mpÄƒrÈ›irea la zero
- ROUND(value, decimals) pentru a rotunji numerele
- LEFT JOIN pentru a pÄƒstra toÈ›i clienÈ›ii chiar dacÄƒ nu au toate datele
- TesteazÄƒ fiecare CTE individual Ã®nainte de a continua la urmÄƒtorul

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•